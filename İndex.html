<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading + Highlight + Tap Translate</title>
<style>
    body { font-family: Arial; padding: 30px; line-height: 1.8; }
    #text span { cursor: pointer; padding: 3px; border-radius: 4px; }
    #text span.highlight { background: yellow; }
    #popup {
        position: absolute;
        background: #333;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        display: none;
        z-index: 9999;
        font-size: 14px;
        max-width: 200px;
    }
    #readBtn {
        padding: 10px 20px;
        background: #0078ff;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
    }
</style>
</head>
<body>

<h2>Reading Demo (Highlight + Tap Translate)</h2>

<button id="readBtn">ðŸ”Š Read Text</button>

<p id="text"></p>

<div id="popup"></div>

<script>
const paragraph = `Learning English can be fun and enjoyable when you interact with the text. 
You can listen to sentences, follow the highlighted words, 
and tap any word to instantly see its meaning.`;

const textContainer = document.getElementById("text");

// ðŸ”¹ Metni kelime kelime bÃ¶lÃ¼p span iÃ§ine koyuyoruz
const words = paragraph.split(" ");
words.forEach((w, i) => {
    const span = document.createElement("span");
    span.textContent = w + " ";
    span.dataset.index = i;
    span.dataset.word = w.replace(/[^a-zA-Z]/g, "");
    textContainer.appendChild(span);
});

// Popup gÃ¶sterme
const popup = document.getElementById("popup");
function showPopup(x, y, tr) {
    popup.style.left = x + "px";
    popup.style.top = y + "px";
    popup.innerText = tr;
    popup.style.display = "block";

    setTimeout(() => popup.style.display = "none", 3000);
}

// Kelime Ã§eviri fonksiyonu
async function translateWord(word) {
    const res = await fetch("https://translate.astian.org/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            q: word,
            source: "en",
            target: "tr",
            format: "text"
        })
    });

    const data = await res.json();
    return data.translatedText;
}

// ðŸ”¹ Kelimeye tÄ±klayÄ±nca Ã§eviri popup
textContainer.addEventListener("click", async (e) => {
    if (e.target.tagName !== "SPAN") return;
    const word = e.target.dataset.word;
    if (!word) return;

    const tr = await translateWord(word);
    showPopup(e.pageX, e.pageY, tr);
});

// ðŸ”¹ Metni okuma ve highlight sistemi
document.getElementById("readBtn").addEventListener("click", () => {
    let i = 0;

    const utter = new SpeechSynthesisUtterance(paragraph);
    utter.lang = "en-US";
    utter.rate = 1;

    // Her kelimeden Ã¶nce highlight
    const interval = setInterval(() => {
        document.querySelectorAll("#text span").forEach(s => s.classList.remove("highlight"));
        
        if (i < words.length) {
            document.querySelector(`#text span[data-index='${i}']`)
                .classList.add("highlight");
            i++;
        } else {
            clearInterval(interval);
        }
    }, 450); // Ortalama hÄ±z (kelime baÅŸÄ±na)

    speechSynthesis.speak(utter);
});
</script>

</body>
</html>
